<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <title>Shooter Spiel</title>
    <style>
        /* --- CSS-Styling --- */
        body {
            margin: 0;
            overflow: hidden;
            background-color: #000;
        }

        canvas {
            display: block;
        }

        #score {
            position: absolute;
            top: 10px;
            left: 10px;
            color: #fff;
            font-family: Arial, sans-serif;
            font-size: 24px;
        }
    </style>
</head>
<body>
    <canvas id="gameCanvas"></canvas>
    <div id="score">Punkte: 0</div>

    <script>
        /* --- JavaScript-Code --- */

        // Canvas initialisieren
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        // Spielerklasse
        class Player {
            constructor(x, y, radius, color) {
                this.x = x;
                this.y = y;
                this.radius = radius;
                this.color = color;
            }

            draw() {
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2, false);
                ctx.fillStyle = this.color;
                ctx.fill();
            }
        }

        // Projektilklasse
        class Projectile {
            constructor(x, y, radius, color, velocity) {
                this.x = x;
                this.y = y;
                this.radius = radius;
                this.color = color;
                this.velocity = velocity;
            }

            draw() {
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2, false);
                ctx.fillStyle = this.color;
                ctx.fill();
            }

            update() {
                this.draw();
                this.x += this.velocity.x;
                this.y += this.velocity.y;
            }
        }

        // Gegnerklasse
        class Enemy {
            constructor(x, y, radius, color, velocity) {
                this.x = x;
                this.y = y;
                this.radius = radius;
                this.color = color;
                this.velocity = velocity;
            }

            draw() {
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2, false);
                ctx.fillStyle = this.color;
                ctx.fill();
            }

            update() {
                this.draw();
                this.x += this.velocity.x;
                this.y += this.velocity.y;
            }
        }

        // Partikelklasse für Explosionseffekte
        class Particle {
            constructor(x, y, radius, color, velocity) {
                this.x = x;
                this.y = y;
                this.radius = radius;
                this.color = color;
                this.velocity = velocity;
                this.alpha = 1;
            }

            draw() {
                ctx.save();
                ctx.globalAlpha = this.alpha;
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2, false);
                ctx.fillStyle = this.color;
                ctx.fill();
                ctx.restore();
            }

            update() {
                this.draw();
                this.x += this.velocity.x;
                this.y += this.velocity.y;
                this.alpha -= 0.01;
            }
        }

        // Initialisierung der Spielvariablen
        const x = canvas.width / 2;
        const y = canvas.height / 2;
        const player = new Player(x, y, 15, 'white');
        const projectiles = [];
        const enemies = [];
        const particles = [];
        let score = 0;

        // Punktestand aktualisieren
        function updateScore() {
            document.getElementById('score').innerText = 'Punkte: ' + score;
        }

        // Gegner erstellen
        function spawnEnemies() {
            setInterval(() => {
                const radius = Math.random() * (30 - 5) + 5;
                let x;
                let y;

                // Zufällige Position außerhalb des Bildschirms
                if (Math.random() < 0.5) {
                    x = Math.random() < 0.5 ? 0 - radius : canvas.width + radius;
                    y = Math.random() * canvas.height;
                } else {
                    x = Math.random() * canvas.width;
                    y = Math.random() < 0.5 ? 0 - radius : canvas.height + radius;
                }

                const color = `hsl(${Math.random() * 360}, 50%, 50%)`;
                const angle = Math.atan2(player.y - y, player.x - x);
                const velocity = {
                    x: Math.cos(angle),
                    y: Math.sin(angle)
                };

                enemies.push(new Enemy(x, y, radius, color, velocity));
            }, 1000);
        }

        let animationId;
        function animate() {
            animationId = requestAnimationFrame(animate);
            ctx.fillStyle = 'rgba(0, 0, 0, 0.1)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            player.draw();
            particles.forEach((particle, index) => {
                if (particle.alpha <= 0) {
                    particles.splice(index, 1);
                } else {
                    particle.update();
                }
            });

            projectiles.forEach((projectile, index) => {
                projectile.update();

                // Entfernen des Projektils, wenn es außerhalb des Bildschirms ist
                if (
                    projectile.x + projectile.radius < 0 ||
                    projectile.x - projectile.radius > canvas.width ||
                    projectile.y + projectile.radius < 0 ||
                    projectile.y - projectile.radius > canvas.height
                ) {
                    setTimeout(() => {
                        projectiles.splice(index, 1);
                    }, 0);
                }
            });

            enemies.forEach((enemy, index) => {
                enemy.update();

                // Kollision mit dem Spieler
                const distToPlayer = Math.hypot(player.x - enemy.x, player.y - enemy.y);
                if (distToPlayer - enemy.radius - player.radius < 1) {
                    cancelAnimationFrame(animationId);
                    alert('Spiel beendet! Endpunktestand: ' + score);
                }

                projectiles.forEach((projectile, projectileIndex) => {
                    const dist = Math.hypot(projectile.x - enemy.x, projectile.y - enemy.y);

                    // Wenn Projektil den Gegner trifft
                    if (dist - enemy.radius - projectile.radius < 1) {
                        // Explosionseffekte
                        for (let i = 0; i < enemy.radius * 2; i++) {
                            particles.push(
                                new Particle(
                                    projectile.x,
                                    projectile.y,
                                    Math.random() * 2,
                                    enemy.color,
                                    {
                                        x: (Math.random() - 0.5) * (Math.random() * 6),
                                        y: (Math.random() - 0.5) * (Math.random() * 6)
                                    }
                                )
                            );
                        }

                        if (enemy.radius - 10 > 5) {
                            // Verkleinern des Gegners
                            score += 50;
                            updateScore();
                            gsap.to(enemy, {
                                radius: enemy.radius - 10
                            });
                            setTimeout(() => {
                                projectiles.splice(projectileIndex, 1);
                            }, 0);
                        } else {
                            // Entfernen des Gegners
                            score += 100;
                            updateScore();
                            setTimeout(() => {
                                enemies.splice(index, 1);
                                projectiles.splice(projectileIndex, 1);
                            }, 0);
                        }
                    }
                });
            });
        }

        // Eventlistener für Schüsse
        addEventListener('click', (event) => {
            const angle = Math.atan2(event.clientY - player.y, event.clientX - player.x);
            const velocity = {
                x: Math.cos(angle) * 5,
                y: Math.sin(angle) * 5
            };
            projectiles.push(
                new Projectile(player.x, player.y, 5, 'white', velocity)
            );
        });

        // Spiel starten
        animate();
        spawnEnemies();

        // Anpassung bei Fenstergrößenänderung
        addEventListener('resize', () => {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            player.x = canvas.width / 2;
            player.y = canvas.height / 2;
        });
    </script>
</body>
</html>
